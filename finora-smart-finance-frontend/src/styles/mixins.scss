// ============================================
// üß∞ SCSS MIXINS - REUSABLE STYLE PATTERNS
// ============================================
// Purpose: Alle wiederverwendbaren Funktionen & Mixins
// Nutzt nur variables.scss (via CSS Custom Properties)
// ============================================

// Moderne Sass Module (Dart Sass 3.0 kompatibel)
@use 'sass:map';
@use 'sass:color';

// ============================================
// üì± RESPONSIVE BREAKPOINTS (Mobile-First)
// ============================================

// Breakpoint Values (m√ºssen als SCSS-Variablen existieren f√ºr @media)
$bp-xs: 480px;
$bp-sm: 640px;
$bp-md: 750px;   // Gr√∂√üere Tablets (10+ Zoll)
$bp-lg: 1024px;
$bp-xl: 1280px;
$bp-2xl: 1536px;

// Mobile-First (min-width)
@mixin xs { @media (min-width: $bp-xs) { @content; } }
@mixin sm { @media (min-width: $bp-sm) { @content; } }
@mixin md { @media (min-width: $bp-md) { @content; } }
@mixin lg { @media (min-width: $bp-lg) { @content; } }
@mixin xl { @media (min-width: $bp-xl) { @content; } }
@mixin xxl { @media (min-width: $bp-2xl) { @content; } }

// Legacy (max-width) - f√ºr spezielle F√§lle
@mixin mobile { @media (max-width: ($bp-sm - 1)) { @content; } }
@mixin tablet { @media (min-width: $bp-sm) and (max-width: ($bp-lg - 1)) { @content; } }
@mixin tablet-md { @media (min-width: $bp-md) and (max-width: ($bp-lg - 1)) { @content; } }  // Gr√∂√üere Tablets
@mixin desktop { @media (min-width: $bp-lg) { @content; } }

// Below breakpoints (max-width) - f√ºr "und kleiner" Szenarien
@mixin below-sm { @media (max-width: ($bp-sm - 1)) { @content; } }
@mixin below-md { @media (max-width: $bp-md) { @content; } }
@mixin below-lg { @media (max-width: ($bp-lg - 1)) { @content; } }

// Custom Breakpoint
@mixin breakpoint($min: null, $max: null) {
  @if $min and $max {
    @media (min-width: $min) and (max-width: $max) { @content; }
  } @else if $min {
    @media (min-width: $min) { @content; }
  } @else if $max {
    @media (max-width: $max) { @content; }
  }
}

// ============================================
// ‚ôø ACCESSIBILITY & MOTION
// ============================================

// Orientation-basierte Queries (f√ºr Tablets)
@mixin portrait {
  @media (orientation: portrait) { @content; }
}

@mixin landscape {
  @media (orientation: landscape) { @content; }
}

// Kombinierte Mixin: Tablet Portrait + Mobile (Card-Layout)
@mixin card-view {
  @media (max-width: 1023px) and (orientation: portrait) { @content; }
  @include mobile { @content; }
}

// Kombinierte Mixin: Tablet Landscape + Desktop (Table-Layout)  
@mixin table-view {
  @media (min-width: 1024px) { @content; }
  @media (max-width: 1023px) and (orientation: landscape) { @content; }
}

@mixin reduced-motion {
  @media (prefers-reduced-motion: reduce) { @content; }
}

@mixin high-contrast {
  @media (prefers-contrast: high) { @content; }
}

@mixin dark-mode {
  @media (prefers-color-scheme: dark) { @content; }
}

@mixin light-mode {
  @media (prefers-color-scheme: light) { @content; }
}

// ============================================
// üìê LAYOUT HELPERS
// ============================================

// Flexbox
@mixin flex($direction: row, $justify: flex-start, $align: stretch, $gap: null) {
  display: flex;
  flex-direction: $direction;
  justify-content: $justify;
  align-items: $align;
  @if $gap { gap: $gap; }
}

@mixin flex-center { 
  display: flex; 
  align-items: center; 
  justify-content: center; 
}

@mixin flex-between { 
  display: flex; 
  align-items: center; 
  justify-content: space-between; 
}

@mixin flex-start {
  display: flex;
  align-items: center;
  justify-content: flex-start;
}

@mixin flex-end {
  display: flex;
  align-items: center;
  justify-content: flex-end;
}

@mixin flex-column {
  display: flex;
  flex-direction: column;
}

@mixin flex-wrap {
  display: flex;
  flex-wrap: wrap;
}

// Grid
@mixin grid($columns: 1, $gap: var(--space-md)) {
  display: grid;
  grid-template-columns: repeat($columns, 1fr);
  gap: $gap;
}

@mixin grid-auto-fit($min-width: 250px, $gap: var(--space-md)) {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax($min-width, 1fr));
  gap: $gap;
}

@mixin grid-auto-fill($min-width: 250px, $gap: var(--space-md)) {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax($min-width, 1fr));
  gap: $gap;
}

// Positioning
@mixin absolute-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
}

@mixin absolute-fill {
  position: absolute;
  inset: 0;
}

@mixin fixed-fill {
  position: fixed;
  inset: 0;
}

// ============================================
// üìù TYPOGRAPHY HELPERS
// ============================================

@mixin truncate {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

@mixin line-clamp($lines: 2) {
  display: -webkit-box;
  -webkit-line-clamp: $lines;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

@mixin text-balance {
  text-wrap: balance;
}

@mixin text-pretty {
  text-wrap: pretty;
}

// ============================================
// üé® VISUAL EFFECTS
// ============================================

// Gradient Backgrounds
@mixin gradient($start, $end, $direction: 135deg) {
  background: linear-gradient($direction, $start, $end);
}

@mixin gradient-radial($start, $end) {
  background: radial-gradient(circle, $start, $end);
}

// Shadows (nutzt CSS vars)
@mixin shadow($level: md) {
  @if $level == sm { box-shadow: var(--sh-sm); }
  @else if $level == md { box-shadow: var(--sh-md); }
  @else if $level == lg { box-shadow: var(--sh-lg); }
  @else if $level == xl { box-shadow: var(--sh-xl); }
}

// ============================================
// üñ±Ô∏è SCROLLBAR STYLING
// ============================================

@mixin custom-scrollbar($width: 8px, $track-color: transparent, $thumb-color: var(--tx-muted)) {
  &::-webkit-scrollbar {
    width: $width;
    height: $width;
  }

  &::-webkit-scrollbar-track {
    background: $track-color;
    border-radius: var(--r-full);
  }

  &::-webkit-scrollbar-thumb {
    background: $thumb-color;
    border-radius: var(--r-full);

    &:hover {
      background: var(--tx);
    }
  }

  // Firefox
  scrollbar-width: thin;
  scrollbar-color: $thumb-color $track-color;
}

@mixin hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
  &::-webkit-scrollbar { display: none; }
}

// ============================================
// üéØ FOCUS & ACCESSIBILITY STYLES
// ============================================

@mixin focus-ring {
  &:focus { outline: none; }
  &:focus-visible {
    outline: none;
    box-shadow: 0 0 0.5px 2px color-mix(in srgb, var(--primary) 12%, transparent);
  }
}

@mixin focus-ring-inset {
  &:focus { 
    outline: none; 
    border-color: var(--primary);
    box-shadow: 0 0 0.5px 2px color-mix(in srgb, var(--primary) 12%, transparent);
  }
  &:focus-visible { 
    outline: none;
    box-shadow: 0 0 0.5px 2px color-mix(in srgb, var(--primary) 12%, transparent);
  }
}

@mixin focus-ring-custom($color) {
  &:focus { outline: none; }
  &:focus-visible {
    outline: none;
    box-shadow: 0 0 0.5px 2px color-mix(in srgb, $color 12%, transparent);
  }
}

// Visually Hidden (f√ºr Screen Reader)
@mixin sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

// Skip Link
@mixin skip-link {
  position: absolute;
  top: -100px;
  left: 0;
  padding: var(--space-md);
  background: var(--primary);
  color: var(--on-primary);
  font-weight: var(--fw-m);
  z-index: var(--z-max);
  transition: top var(--tr-fast);
  
  &:focus { top: 0; }
}

// ============================================
// üîò BUTTON BASE
// ============================================

@mixin button-base {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-xs);
  height: var(--btn-height-md);
  padding: 0 var(--btn-padding-x);
  border: none;
  border-radius: var(--r-md);
  font-family: var(--ff-base);
  font-weight: var(--fw-m);
  font-size: var(--btn-font-size);
  line-height: 1;
  text-decoration: none;
  cursor: pointer;
  user-select: none;
  transition: 
    background var(--tr-fast),
    color var(--tr-fast),
    border-color var(--tr-fast),
    box-shadow var(--tr-fast),
    transform var(--tr-fast);

  &:disabled,
  &[aria-disabled='true'] { 
    opacity: 0.5; 
    cursor: not-allowed; 
    pointer-events: none;
  }

  @include focus-ring;
}

@mixin button-variant($bg, $color: var(--on-primary), $hover-darken: 10%) {
  background: $bg;
  color: $color;
  
  &:hover:not(:disabled) {
    filter: brightness(1.1);
    transform: translateY(-1px);
    box-shadow: var(--sh-md);
  }
  
  &:active:not(:disabled) {
    transform: translateY(0);
  }
}

// ============================================
// üìù INPUT BASE
// ============================================

@mixin input-base {
  width: 100%;
  height: var(--input-height-md);
  padding: 0 var(--input-padding-x);
  background: var(--surface);
  border: var(--input-border-width) solid var(--border);
  border-radius: var(--r-md);
  color: var(--tx);
  font-family: var(--ff-base);
  font-size: var(--fs-md);
  line-height: var(--lh-n);
  transition: 
    background var(--tr-fast),
    border-color var(--tr-fast),
    box-shadow var(--tr-fast);

  &::placeholder { 
    color: var(--tx-muted); 
    opacity: 0.65; 
  }

  &:focus {
    outline: none;
    border-color: var(--primary);
    background: var(--bg);
    box-shadow: 0 0 0 3px rgba(var(--primary-rgb, 99, 102, 241), 0.1);
  }

  &:focus-visible {
    outline: none;
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--primary) 12%, transparent);
  }

  &:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    background: var(--surface-2);
  }
}

// Input Icon - Safe f√ºr absolute Positionierung in Inputs
@mixin input-icon {
  position: absolute;
  background: transparent; // Verhindert √úberdeckung von border-radius
  color: var(--tx-muted);
  pointer-events: none;
  z-index: 1;
  transition: color var(--tr-fast);
}

// ============================================
// üÉè CARD BASE
// ============================================

@mixin card($padding: var(--card-padding), $hover: true) {
  background: var(--surface);
  color: var(--tx);
  border: 1px solid var(--border);
  border-radius: var(--card-radius);
  padding: $padding;
  box-shadow: var(--sh-sm);
  transition: 
    background var(--tr-fast),
    border-color var(--tr-fast),
    box-shadow var(--tr-fast),
    transform var(--tr-fast);

  @if $hover {
    &:hover { 
      box-shadow: var(--sh-md); 
    }
  }
}

@mixin card-interactive {
  @include card;
  cursor: pointer;

  &:hover {
    transform: translateY(-2px);
    box-shadow: var(--sh-lg);
  }

  &:active {
    transform: translateY(0);
  }

  @include focus-ring;
}

// ============================================
// ü™ü MODAL BASE
// ============================================

@mixin modal-overlay {
  @include fixed-fill;
  background: var(--overlay);
  @include flex-center;
  z-index: var(--z-modal);
}

@mixin modal-base($width: var(--modal-width-md)) {
  position: relative;
  background: var(--surface);
  color: var(--tx);
  border: 1px solid var(--border);
  border-radius: var(--r-xl);
  box-shadow: var(--sh-xl);
  width: min($width, 92vw);
  max-height: 90vh;
  overflow: hidden;
}

// ============================================
// ü¶¥ SKELETON LOADING
// ============================================

@mixin skeleton {
  background: linear-gradient(
    90deg,
    var(--skeleton-from) 0%,
    var(--skeleton-to) 50%,
    var(--skeleton-from) 100%
  );
  background-size: 200% 100%;
  animation: skeleton-loading var(--skeleton-duration) ease-in-out infinite;
  will-change: background-position;
}

// ============================================
// üöÄ ANIMATION PERFORMANCE
// ============================================

// GPU-beschleunigte Animationen
@mixin gpu-accelerated {
  transform: translateZ(0);
  backface-visibility: hidden;
  perspective: 1000px;
}

// Will-change f√ºr bekannte Animationen (mit auto-reset)
@mixin will-animate($properties...) {
  will-change: $properties;
  
  // Auto-reset nach Animation (optional via Klasse)
  &.animation-complete {
    will-change: auto;
  }
}

// Optimierte Shimmer-Animation
@mixin shimmer-optimized {
  background: linear-gradient(
    90deg,
    color-mix(in srgb, var(--tx) 8%, transparent) 0%,
    color-mix(in srgb, var(--tx) 15%, transparent) 50%,
    color-mix(in srgb, var(--tx) 8%, transparent) 100%
  );
  background-size: 200% 100%;
  animation: shimmer 1.5s ease-in-out infinite;
  will-change: background-position;
  
  @media (prefers-reduced-motion: reduce) {
    animation: none;
    background: color-mix(in srgb, var(--tx) 10%, transparent);
  }
}

// Reduzierte Animation f√ºr reduced-motion
@mixin motion-safe($animation) {
  @media (prefers-reduced-motion: no-preference) {
    animation: $animation;
  }
}

// ============================================
// üé® COLOR UTILITY FUNCTIONS
// ============================================

// Konvertiert Farbe zu RGB-Werten (f√ºr rgba)
@function color-rgb($color) {
  @return #{color.channel($color, "red", $space: rgb)}, #{color.channel($color, "green", $space: rgb)}, #{color.channel($color, "blue", $space: rgb)};
}

// Ermittelt Kontrastfarbe (Hell/Dunkel)
@function contrast-color($color, $dark, $light) {
  @if color.channel($color, "lightness", $space: hsl) > 60% {
    @return $dark;
  } @else {
    @return $light;
  }
}

// Farbe abdunkeln
@function shade($color, $percent) {
  @return color.mix(black, $color, $percent);
}

// Farbe aufhellen
@function tint($color, $percent) {
  @return color.mix(white, $color, $percent);
}

// Alpha-Transparenz
@function alpha($color, $alpha) {
  @return color.change($color, $alpha: $alpha);
}

// ============================================
// üé® THEME GENERATOR MIXIN
// ============================================
// Erzeugt alle CSS Custom Properties f√ºr ein Theme
// aus ~6 Basisfarben

// Hilfsfunktion: map.get mit Fallback-Wert
@function map-get-default($m, $key, $default) {
  @if map.has-key($m, $key) {
    @return map.get($m, $key);
  } @else {
    @return $default;
  }
}

@mixin generate-theme($name, $palette) {
  $bg: map.get($palette, background);
  $tx: map.get($palette, text);
  $pri: map.get($palette, primary);
  $sec: map.get($palette, secondary);
  $acc: map.get($palette, accent);
  $success: map-get-default($palette, success, $pri);
  $warning: map-get-default($palette, warning, $pri);
  $error: map-get-default($palette, error, $pri);
  $info: map-get-default($palette, info, $pri);

  [data-theme="#{$name}"] {
    // ========== BACKGROUNDS ==========
    --background: #{$bg};
    --bg: #{$bg};
    --bg-primary: #{$bg};
    --bg-secondary: #{tint($bg, 6%)};
    
    // ========== TEXT ==========
    --text: #{$tx};
    --tx: #{$tx};
    --tx-muted: #{tint($tx, 45%)};
    --text-disabled: #{tint($tx, 65%)};
    --text-primary: #{$tx};
    --text-secondary: #{tint($tx, 30%)};
    --text-muted: #{tint($tx, 45%)};
    
    // ========== SURFACES & BORDERS ==========
    --surface: #{tint($bg, 6%)};
    --surface-2: #{tint($bg, 10%)};
    --surface-3: #{tint($bg, 14%)};
    --overlay: #{alpha($tx, 0.5)};
    --border: #{alpha($tx, 0.12)};
    --border-light: #{alpha($tx, 0.06)};
    --border-strong: #{alpha($tx, 0.18)};
    --border-primary: #{alpha($tx, 0.12)};
    --divider: var(--border);
    
    // ========== PRIMARY ==========
    --primary: #{$pri};
    --pri: var(--primary);
    --pri-hover: #{shade($pri, 10%)};
    --primary-rgb: #{color-rgb($pri)};
    --on-primary: #{contrast-color($pri, $tx, $bg)};
    --accent-primary: #{$pri};
    
    // ========== SECONDARY ==========
    --secondary: #{$sec};
    --sec: var(--secondary);
    --sec-hover: #{shade($sec, 10%)};
    --secondary-rgb: #{color-rgb($sec)};
    --on-secondary: #{contrast-color($sec, $tx, $bg)};
    --accent-secondary: #{$sec};
    
    // ========== ACCENT ==========
    --accent: #{$acc};
    --acc: var(--accent);
    --acc-hover: #{shade($acc, 10%)};
    --accent-rgb: #{color-rgb($acc)};
    --on-accent: #{contrast-color($acc, $tx, $bg)};
    
    // ========== STATUS COLORS ==========
    --success: #{$success};
    --success-hover: #{shade($success, 10%)};
    --success-rgb: #{color-rgb($success)};
    --on-success: #{contrast-color($success, $tx, $bg)};
    
    --warning: #{$warning};
    --warning-hover: #{shade($warning, 10%)};
    --warning-rgb: #{color-rgb($warning)};
    --on-warning: #{contrast-color($warning, $tx, $bg)};
    
    --error: #{$error};
    --error-hover: #{shade($error, 10%)};
    --error-rgb: #{color-rgb($error)};
    --on-error: #{contrast-color($error, $tx, $bg)};
    
    --info: #{$info};
    --info-hover: #{shade($info, 10%)};
    --info-rgb: #{color-rgb($info)};
    --on-info: #{contrast-color($info, $tx, $bg)};
    
    // ========== SHADOWS ==========
    --sh-sm: 0 1px 2px 0 #{alpha($tx, 0.05)};
    --sh-md: 0 4px 6px -1px #{alpha($tx, 0.08)}, 0 2px 4px -1px #{alpha($tx, 0.06)};
    --sh-lg: 0 10px 15px -3px #{alpha($tx, 0.12)}, 0 4px 6px -2px #{alpha($tx, 0.08)};
    --sh-xl: 0 20px 25px -5px #{alpha($tx, 0.16)}, 0 10px 10px -5px #{alpha($tx, 0.10)};
    --sh-2xl: 0 25px 50px -12px #{alpha($tx, 0.25)};
    
    // ========== FOCUS RING ==========
    --focus-ring-color: #{$pri};
  }
}

// ============================================
// üì± SCROLLABLE PANEL (Mobile-optimized)
// ============================================
@mixin scrollable-panel($max-height: 100%) {
  max-height: $max-height;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
  @include custom-scrollbar;
}

// ============================================
// üîê AUTH PANEL BASE
// ============================================
@mixin auth-panel-base {
  position: relative;
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
  padding: var(--auth-content-padding);
  
  @include mobile {
    padding: var(--auth-content-padding-mobile);
  }
}

// ============================================
// üì± SAFE VIEWPORT HEIGHT
// ============================================
@mixin safe-viewport-height($property: min-height) {
  #{$property}: 100vh;
  #{$property}: 100svh;
  
  @supports (#{$property}: 100dvh) {
    #{$property}: 100dvh;
  }
}

// ============================================
// üëÜ TOUCH TARGET (Accessibility)
// ============================================
@mixin touch-target {
  min-height: var(--touch-target-min);
  min-width: var(--touch-target-min);
}
